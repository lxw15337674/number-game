# 数字找茬：RPG 进化版设计文档 (v4.0 - Final)

## 1. 核心机制 (Core Mechanics)

### 1.1 时间接力 (Time Relay)
游戏采用 **全局共享倒计时** 机制。
*   **初始时间**: 60秒。
*   **消耗**: 自然流逝 (-1s/s) + 错误惩罚 (-10s)。
*   **回复**: 通关奖励 (+10s)。
*   **失败**: 时间归零 -> 结算 -> 进度重置 (保留金币)。

### 1.2 能量爆发 (Energy & Fever)
*   **能量槽 (Energy Bar)**: 上限 100。
*   **获取**: 过关 (+30)，正确操作 (+10)。
*   **流失**: 自然衰减 (-2/s)，错误惩罚 (-50)。
*   **Fever Mode**: 
    *   能量满 100 自动触发，持续 **8秒**。
    *   **效果**: 全局倒计时 **暂停**，金币 **x2**。
    *   **视觉**: 界面泛金光，能量条燃烧特效。

### 1.3 局内成长 (Perks) - Roguelike 元素
每击败 **Boss** 后（每 5 关），触发 **“命运三选一”**。
*   **时间窃贼**: 每答对一次额外 +1秒。
*   **充能大师**: 能量获取速度 +50%。
*   **贪婪之手**: 关卡金币奖励 +50%。
*   **鹰眼**: 错误选项有 20% 概率直接消失。
*   **护盾**: 抵挡一次错误点击的惩罚 (每关重置)。

### 1.4 Boss 挑战 (Boss Battles)
每 **5** 关遭遇一次 Boss 战（第 5, 10, 15... 关）。
*   **多阶段血条**: Boss 拥有 **3 点生命值**。
*   **连战机制**: 玩家需要在当前关卡内，连续完成 3 次目标（例如：找出 3 次最大数，或解开 3 道算式），中间不能出错。
*   **奖励**: 击败 Boss 后获得大量金币，并进入 Perk 选择环节。

## 2. 关卡系统 (Level System)

### 2.1 章节与主题 (Biomes)
为了减少视觉疲劳，每 5 关切换一个视觉主题。
*   **L1-5 (赛博空间)**: 霓虹蓝/黑背景，规则：找数字。
*   **L6-10 (机械工厂)**: 黄铜/锈色背景，规则：找算式。
*   **L21+ (无尽虚空)**: 紫色/星空背景，规则：随机无尽。

### 2.2 难度控制
*   **混合结构**: Phase 1 (1-20) 固定配置 -> Phase 2 (21+) 算法生成。
*   **维度**: 网格密度(3x3->8x8)、数值范围(100->999)、规则复杂度。

## 3. 经济与养成 (Economy)

### 3.1 货币与存档
*   **金币**: 永久保留。
*   **存档**: 记录金币、最高关卡记录、已购买的永久升级。

### 3.2 永久升级 (Meta Upgrades)
在主菜单购买：
1.  **沙漏 (Max Time)**: 初始时间上限提升。
2.  **存钱罐 (Coin Gain)**: 金币获取率提升。
3.  **冷静 (Penalty Reduce)**: 错误惩罚时间减少。

## 4. 道具系统 (Items)

| 道具 | 价格 | 效果 |
| :--- | :--- | :--- |
| **复活币** | 200 | 死亡复活 +30s。 |
| **冲刺鞋** | 50 | 跳过前 5 关。 |
| **紧急急救包** | 30 | 游戏内使用，立即 +20s。 |

## 5. UI 流程 (UI Flow)

1.  **Main Menu**: [开始] [强化] [商店]。
2.  **Game Loop**:
    *   **Game Scene**: 倒计时、能量条、Fever 特效。
    *   **Boss Encounter**: Boss 血条显示。
    *   **Perk Selection**: 弹窗三选一。
3.  **Result**: 结算面板。

## 6. 技术实现路线 (Roadmap)

1.  **Phase 1: 数据基石**
    *   `GameData.ts`: 存档。
    *   `LevelManager.ts`: 关卡与主题配置。

2.  **Phase 2: 核心重构**
    *   `Game.ts`: 全局计时、能量槽、Boss 多阶段逻辑。

3.  **Phase 3: 界面交互**
    *   制作 Perk UI、Boss 血条 UI。