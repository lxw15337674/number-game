# 数字找茬：RPG 进化版设计文档 (v4.0 - Final)

## 1. 核心机制 (Core Mechanics)

### 1.1 时间接力 (Time Relay)
游戏采用 **全局共享倒计时** 机制。
*   **初始时间**: 60秒。
*   **消耗**: 自然流逝 (-1s/s) + 错误惩罚 (-10s)。
*   **回复**: 通关奖励 (+10s)。
*   **失败**: 时间归零 -> 结算 -> 进度重置 (保留金币)。

### 1.2 能量爆发 (Energy & Fever)
*   **能量槽 (Energy Bar)**: 上限 100。
*   **获取**: 过关 (+30)，正确操作 (+10)。
*   **流失**: 自然衰减 (-2/s)，错误惩罚 (-50)。
*   **Fever Mode**: 
    *   能量满 100 自动触发，持续 **8秒**。
    *   **效果**: 全局倒计时 **暂停**，金币 **x2**。
    *   **视觉**: 界面泛金光，能量条燃烧特效。

### 1.3 局内成长 (Perks) - Roguelike 元素
每击败 **Boss** 后（每 5 关），触发 **“命运三选一”**。
*   **时间窃贼**: 每答对一次额外 +1秒。
*   **充能大师**: 能量获取速度 +50%。
*   **贪婪之手**: 关卡金币奖励 +50%。
*   **鹰眼**: 错误选项有 20% 概率直接消失。
*   **护盾**: 抵挡一次错误点击的惩罚 (每关重置)。

### 1.4 Boss 挑战 (Boss Battles)
每 **5** 关遭遇一次 Boss 战（第 5, 10, 15... 关）。
*   **多阶段血条**: Boss 拥有 **3 点生命值**。
*   **连战机制**: 玩家需要在当前关卡内，连续完成 3 次目标（例如：找出 3 次最大数，或解开 3 道算式），中间不能出错。
*   **奖励**: 击败 Boss 后获得大量金币，并进入 Perk 选择环节。

## 2. 关卡系统 (Level System)

### 2.1 章节与主题 (Biomes)
为了减少视觉疲劳，每 5 关切换一个视觉主题。
*   **L1-5 (赛博空间)**: 霓虹蓝/黑背景，规则：找数字。
*   **L6-10 (机械工厂)**: 黄铜/锈色背景，规则：找算式。
*   **L21+ (无尽虚空)**: 紫色/星空背景，规则：随机无尽。

### 2.2 难度控制
*   **混合结构**: Phase 1 (1-20) 固定配置 -> Phase 2 (21+) 算法生成。
*   **维度**: 网格密度(3x3->8x8)、数值范围(100->999)、规则复杂度。

## 3. 经济与养成 (Economy)

### 3.1 货币与存档
*   **金币**: 永久保留。
*   **存档**: 记录金币、最高关卡记录、已购买的永久升级。

### 3.2 永久升级 (Meta Upgrades)
在主菜单购买：
1.  **沙漏 (Max Time)**: 初始时间上限提升。
2.  **存钱罐 (Coin Gain)**: 金币获取率提升。
3.  **冷静 (Penalty Reduce)**: 错误惩罚时间减少。

## 4. 道具系统 (Items)

| 道具 | 价格 | 效果 |
| :--- | :--- | :--- |
| **复活币** | 200 | 死亡复活 +30s。 |
| **冲刺鞋** | 50 | 跳过前 5 关。 |
| **紧急急救包** | 30 | 游戏内使用，立即 +20s。 |

## 5. UI 流程 (UI Flow)

1.  **Main Menu**: [开始] [强化] [商店]。
2.  **Game Loop**:
    *   **Game Scene**: 倒计时、能量条、Fever 特效。
    *   **Boss Encounter**: Boss 血条显示。
    *   **Perk Selection**: 弹窗三选一。
3.  **Result**: 结算面板。

## 6. 技术实现路线 (Roadmap)

1.  **Phase 1: 数据基石**
    *   `GameData.ts`: 存档。
    *   `LevelManager.ts`: 关卡与主题配置。

2.  **Phase 2: 核心重构**
    *   `Game.ts`: 全局计时、能量槽、Boss 多阶段逻辑。

3.  **Phase 3: 界面交互**
    *   制作 Perk UI、Boss 血条 UI。

## 7. 物理动画特效 (Visual Effects)

采用 **卡通弹性风格**，强调 Squash & Stretch、过冲回弹、夸张形变。

### 7.1 粒子上限配置
| 特效类型 | 单次上限 | 同屏上限 |
|:---|:---:|:---:|
| 正确爆发粒子 | 30 | 60 |
| 金币 | 20 | 40 |
| Fever 上升粒子 | - | 50 |
| Fever 火焰 | - | 10 |
| **总计** | - | **~160** |

### 7.2 P0 核心特效

#### 7.2.1 格子点击反馈 (Squash & Stretch)
- **动画序列**: 压扁(1.2, 0.8) → 回弹(0.85, 1.2) → 过冲(1.1, 0.95) → 归位(1, 1)
- **时长**: 180ms
- **曲线**: Back.easeOut (弹性过冲)

#### 7.2.2 正确答案反馈
**数字飞出**:
- 放大 1.4x + 绿色高亮
- 贝塞尔曲线飞向得分区 (向上弧线)
- 飞行中缩小 + 淡出
- 时长: 500ms

**粒子爆发**:
- 类型: 星星
- 数量: 25 个
- 行为: 中心喷射 + 重力下落 + 旋转 + 淡出
- 时长: 600ms

#### 7.2.3 错误答案反馈
**屏幕震动**:
- 强度: 1.2%
- 时长: 250ms

**格子反馈**:
- 变红 + 水平震动 (±8px, 40ms/次, 重复4次)
- 显示 ✕ 标记 (弹入 + 淡出)

### 7.3 P1 奖励特效

#### 7.3.1 金币喷射收集
**喷射阶段** (400ms):
- 从中心向上喷出
- 随机角度 + 随机初速度
- 带重力抛物线
- 旋转动画
- 数量: 根据奖励金额缩放 (最多15个)

**磁吸阶段** (600ms):
- 延迟 500ms 启动
- 依次加速飞向右上角金币计数器
- 到达时缩小消失
- 金币计数器弹跳反馈

#### 7.3.2 Fever 模式特效
**持续上升粒子**:
- 金色光点从底部上升
- 左右正弦摇摆
- 同屏上限: 50
- 速度: 80-150 px/s

**边缘光晕**:
- 屏幕边缘金色渐变
- 呼吸脉动: 500ms/次
- Alpha: 0 ↔ 0.15

**能量条火焰**:
- 火焰粒子从能量条上升腾
- 颜色渐变: 橙红 → 金黄
- 上限: 10 个

### 7.4 P2 增强特效 (后期规划)
- Boss 受击震颤 + 击退动画
- UI 面板弹性滑入/弹出
- Perk 卡牌 3D 翻转
- 过关场景切换动画
- 倒计时紧张警告 (红色脉动)